<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Crop and water mark adder</title>
    <link rel="stylesheet" href="styles/normalize.css">
    <link rel="stylesheet" href="styles/style.css">
    <script src="dist/tinycrop.js"></script>
</head>

<body>
    <div class="container">
        <div id="mount" class="mount"></div>
        <div id="mount" class="mount">
            <canvas id="canvas"></canvas>
        </div>

        <div style="display:none;">
            <img id="source" src="https://mdn.mozillademos.org/files/5397/rhino.jpg" width="300" height="227">
        </div>
        <!--
      -->
        <div class="info">
            <div class="field-pair">
                <div class="field">
                    <input type="text" id="input-x" value="0" />
                    <label for="input-x">X</label>
                </div>
                <div class="field">
                    <input type="text" id="input-y" value="0" />
                    <label for="input-x">Y</label>
                </div>
            </div>
            <!--
        -->
            <div class="field-pair">
                <div class="field">
                    <input type="text" id="input-width" value="0" />
                    <label for="input-x">Width</label>
                </div>
                <div class="field">
                    <input type="text" id="input-height" value="0" />
                    <label for="input-x">Height</label>
                </div>
            </div>

            <button id="swap-image">Swap image</button>
            <!--
        --><button id="aspect-16-by-9">16:9 aspect ratio</button>
            <!--
        --><button id="aspect-square">Square aspect ratio</button>
            <!--
        --><button id="aspect-free">Free aspect ratio</button>
            <!--
        --><button id="container-fit-to-image">Fit container to image</button>
            <!--
        --><button id="container-square">Square container</button>
            <!--
        --><button id="container-2-by-1">2:1 container</button>
            <!--
        --><button id="change-background-colors">Change background colors</button>
        </div>

        <footer class="footer">Visit the <a href="https://github.com/WebSeed/tinycrop">GitHub project</a> page.</footer>
    </div>

    <script>
        var crop = tinycrop.create({
            parent: '#mount',
            image: 'images/test.JPG',
            bounds: {
                width: '100%',
                height: '50%'
            },
            // backgroundColors: ['#fff', '#f0f0f0'],
            selection: {
                // color: 'red',
                // activeColor: 'blue',
                // aspectRatio: 4 / 3,
                // minWidth: 200,
                // minHeight: 300
                // width: 400,
                // height: 500,
                // x: 100,
                // y: 500
            }
        })

        function getId(id) {
            return document.getElementById(id)
        }

        var inputX = getId('input-x')
        var inputY = getId('input-y')
        var inputWidth = getId('input-width')
        var inputHeight = getId('input-height')

        var buttonSwapImage = getId('swap-image')

        buttonSwapImage.addEventListener('click', function (e) {
            e.preventDefault()
            crop.setImage(
                crop.getImage().src !== 'images/landscape2.jpg' ?
                    'images/landscape2.jpg' :
                    'images/portrait.jpg'
            )
        })

        var buttonAspect16By9 = getId('aspect-16-by-9')
        buttonAspect16By9.addEventListener('click', function (e) {
            e.preventDefault()
            crop.setAspectRatio(16 / 9)
        })

        var buttonAspect1By1 = getId('aspect-square')
        buttonAspect1By1.addEventListener('click', function (e) {
            e.preventDefault()
            crop.setAspectRatio(1)
        })

        var buttonAspectFree = getId('aspect-free')
        buttonAspectFree.addEventListener('click', function (e) {
            e.preventDefault()
            crop.setAspectRatio(null)
        })

        var buttonContainerFitImage = getId('container-fit-to-image')
        buttonContainerFitImage.addEventListener('click', function (e) {
            e.preventDefault()
            crop.setBounds({ width: '100%', height: 'auto' })
        })

        var buttonContainerSquare = getId('container-square')
        buttonContainerSquare.addEventListener('click', function (e) {
            e.preventDefault()
            crop.setBounds({ width: '100%', height: '100%' })
        })

        var buttonContainer2By1 = getId('container-2-by-1')
        buttonContainer2By1.addEventListener('click', function (e) {
            e.preventDefault()
            crop.setBounds({ width: '100%', height: '50%' })
        })

        var backgroundColorPreset = 0

        var buttonChangeBackgroundColors = getId('change-background-colors')
        buttonChangeBackgroundColors.addEventListener('click', function (e) {
            e.preventDefault()
            backgroundColorPreset = (backgroundColorPreset + 1) % 4
            switch (backgroundColorPreset) {
                case 0:
                    crop.setBackgroundColors(['#ffffff', '#f0f0f0'])
                    break
                case 1:
                    crop.setBackgroundColors(['#000000', '#202020'])
                    break
                case 2:
                    crop.setBackgroundColors(['#38f'])
                    break
                case 3:
                    crop.setBackgroundColors(null)
                    break
            }
        })

        function setInputsFromRegion(region) {
            inputX.value = region.x
            inputY.value = region.y
            inputWidth.value = region.width
            inputHeight.value = region.height
        }

        crop
            .on('start', function (region) {
                console.log("start")
                setInputsFromRegion(region)
            })
            .on('move', function (region) {
                console.log("move")
                setInputsFromRegion(region)
            })
            .on('resize', function (region) {
                console.log("resize")
                setInputsFromRegion(region)
            })
            .on('change', function (region) {
                console.log("change")
                setInputsFromRegion(region)
            })
            .on('end', function (region) {
                console.log("end")
                canvas = document.getElementById('canvas');
                ctx = canvas.getContext('2d');
                image = new Image(); // Using optional size for image
                image.onload = drawImageActualSize; // Draw when image has loaded
                // Load an image of intrinsic size 300x227 in CSS pixels
                image.src = 'images/test.JPG';
                function drawImageActualSize() {
                    // Use the intrinsic size of image in CSS pixels for the canvas element
                    canvas.width = region.width / 2;
                    canvas.height = region.height / 2;
                    // To use the custom size we'll have to specify the scale parameters
                    // using the element's width and height properties - lets draw one
                    // on top in the corner:
                    ctx.drawImage(this, region.x, region.y, region.width, region.height, 0, 0, region.width / 2, region.height / 2);
                }
                setInputsFromRegion(region)
            })
        function waterMark() {
            let cnvs = document.getElementById("canvas")
            let ctx = cnvs.getContext("2d")
            ctx.globalAlpha = 0.7
            ctx.fillStyle = "black";
            ctx.strokeStyle = "rgb(255, 0, 0)";
            roundRect(ctx, cnvs.width / 2 - 50, cnvs.height / 2 - 50, 100, 100, 20, true);
            ctx.fillStyle = "red";
            ctx.textAlign = 'center';
            ctx.font = '500 ' + 100 + 'px Sans-serif';
            ctx.fillText("test", cnvs.width / 2, cnvs.height / 2);
            ctx.fillStyle = "black";
            ctx.fillStyle = "red";
            ctx.textAlign = 'center';
            ctx.font = '500 ' + 100 + 'px Sans-serif';
            ctx.fillText("test", cnvs.width / 2, cnvs.height - 100);
        }

        /**
         * Draws a rounded rectangle using the current state of the canvas.
         * If you omit the last three params, it will draw a rectangle
         * outline with a 5 pixel border radius
         * @param {CanvasRenderingContext2D} ctx
         * @param {Number} x The top left x coordinate
         * @param {Number} y The top left y coordinate
         * @param {Number} width The width of the rectangle
         * @param {Number} height The height of the rectangle
         * @param {Number} [radius = 5] The corner radius; It can also be an object 
         *                 to specify different radii for corners
         * @param {Number} [radius.tl = 0] Top left
         * @param {Number} [radius.tr = 0] Top right
         * @param {Number} [radius.br = 0] Bottom right
         * @param {Number} [radius.bl = 0] Bottom left
         * @param {Boolean} [fill = false] Whether to fill the rectangle.
         * @param {Boolean} [stroke = true] Whether to stroke the rectangle.
         */
        function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
            if (typeof stroke === 'undefined') {
                stroke = true;
            }
            if (typeof radius === 'undefined') {
                radius = 5;
            }
            if (typeof radius === 'number') {
                radius = { tl: radius, tr: radius, br: radius, bl: radius };
            } else {
                var defaultRadius = { tl: 0, tr: 0, br: 0, bl: 0 };
                for (var side in defaultRadius) {
                    radius[side] = radius[side] || defaultRadius[side];
                }
            }
            ctx.beginPath();
            ctx.moveTo(x + radius.tl, y);
            ctx.lineTo(x + width - radius.tr, y);
            ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
            ctx.lineTo(x + width, y + height - radius.br);
            ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
            ctx.lineTo(x + radius.bl, y + height);
            ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
            ctx.lineTo(x, y + radius.tl);
            ctx.quadraticCurveTo(x, y, x + radius.tl, y);
            ctx.closePath();
            if (fill) {
                ctx.fill();
            }
            if (stroke) {
                ctx.stroke();
            }

        }

    </script>

</body>


</html>